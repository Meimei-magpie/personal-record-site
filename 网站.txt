#é¡¹ç›®ç»“æ„#
/personal-record-site
    /backend
        server.js
    /frontend
        /src
            /components
                Editor.js
                ImageUploader.js
                WorldMap.js
                UserProfile.js
            App.js
            index.js
    package.json
#åˆ›å»ºREACTé¡¹ç›®#
npx create-react-app frontend
cd frontend
npm install react-quill leaflet react-leaflet react-filepond filepond

#APP.JS#
import React from 'react';
import WorldMap from './components/WorldMap';
import UserProfile from './components/UserProfile';
import Editor from './components/Editor';
import ImageUploader from './components/ImageUploader';
import React, { useEffect } from 'react';

function App() {
 useEffect(() => {
    console.log('ğŸš€ Appç»„ä»¶å·²åŠ è½½ï¼');
    console.log('ğŸ“ ç¯å¢ƒå˜é‡ REACT_APP_API_URL:', process.env.REACT_APP_API_URL);
    console.log('ğŸ“ æ‰€æœ‰ç¯å¢ƒå˜é‡:', process.env);
    
    // æ·»åŠ ä¸€ä¸ªæ˜æ˜¾çš„é”™è¯¯ä¿¡æ¯æµ‹è¯•
    console.error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é”™è¯¯ä¿¡æ¯ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ï¼');
  }, []);
useEffect(() => {
    console.log('ç¯å¢ƒå˜é‡ REACT_APP_API_URL:', process.env.REACT_APP_API_URL);
    console.log('æ‰€æœ‰REACT_APPå¼€å¤´çš„å˜é‡:', 
      Object.keys(process.env).filter(key => key.startsWith('REACT_APP_')));
  }, []);
  return (
    <div style={{ display: 'flex', flexDirection: 'column', height: '100vh' }}>
      <WorldMap />
      <div style={{ position: 'absolute', top: '20px', left: '20px', color: 'white' }}>
        <h1>ä¸ªäººè®°å½•å®è§‚ä¿¡æ¯</h1>
      </div>
      <div style={{ position: 'absolute', top: '100px', left: '20px', color: 'white' }}>
        <h2>ä¸ªäººä»‹ç»</h2>
        <UserProfile />
      </div>
      <div style={{ position: 'absolute', top: '300px', left: '20px', color: 'white' }}>
        <h2>å®è§‚è§£è¯»</h2>
        <Editor />
      </div>
      <div style={{ position: 'absolute', top: '500px', left: '20px', color: 'white' }}>
        <h2>ä¸Šä¼ å›¾ç‰‡</h2>
        <ImageUploader />
      </div>
    </div>
  );
}

export default App;
#ä¸–ç•Œåœ°å›¾èƒŒæ™¯#
import React from 'react';
import { MapContainer, TileLayer } from 'react-leaflet';
import 'leaflet/dist/leaflet.css';

function WorldMap() {
  return (
    <MapContainer center={[0, 0]} zoom={2} style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100vh', zIndex: -1 }}>
      <TileLayer url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png" />
    </MapContainer>
  );
}
export default WorldMap;
#å±•ç¤ºä¸ªäººä¿¡æ¯#
import React, { useState } from 'react';

function UserProfile() {
  const [intro, setIntro] = useState('ä½œè€…å¸Œæœ›åœ¨è¿™é‡Œè®°å½•å¯¹å…¨çƒå®è§‚å˜åŠ¨çš„è§‚å¯Ÿ');

  const handleChange = (e) => {
    setIntro(e.target.value);
  };

  return (
    <div>
      <textarea
        value={intro}
        onChange={handleChange}
        rows="4"
        cols="50"
        style={{ width: '300px' }}
      />
    </div>
  );
}

export default UserProfile;
#å®è§‚è§£è¯»çš„å¯Œæ–‡æœ¬åŠŸèƒ½#
import React, { useState } from 'react';
import ReactQuill from 'react-quill';
import 'react-quill/dist/quill.snow.css';

function Editor() {
  const [content, setContent] = useState('');

  const handleChange = (value) => {
    setContent(value);
  };

  return (
    <div>
      <ReactQuill value={content} onChange={handleChange} />
    </div>
  );
}

export default Editor;
#å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½#
import React, { useState } from 'react';
import { FilePond } from 'react-filepond';
import 'filepond/dist/filepond.min.css';

function ImageUploader() {
  const [files, setFiles] = useState([]);
  
  const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000';
  console.log('å½“å‰APIåœ°å€:', API_URL);

  const handleUpdateFiles = (fileItems) => {
    setFiles(fileItems.map(fileItem => fileItem.file));
  };
const serverConfig = {
    process: {
      url: `${API_URL}/upload`,
      method: 'POST',
      withCredentials: false
    }
  };
  
  console.log('FilePond æœåŠ¡å™¨é…ç½®:', serverConfig);
  console.log('å®Œæ•´ä¸Šä¼ URL:', serverConfig.process.url);

  const handleUpdateFiles = (fileItems) => {
    setFiles(fileItems.map(fileItem => fileItem.file));
  };
  return (
    <div>
      <FilePond
        files={files}
        onupdatefiles={handleUpdateFiles}
        server={{
          process: {
            url: `${API_URL}/upload`,
            method: 'POST',
            withCredentials: false
          }
        }}
        name="image"
        labelIdle='æ‹–æ”¾æ–‡ä»¶æˆ– <span class="filepond--label-action">æµè§ˆ</span>'
      />
    </div>
  );
}

export default ImageUploader;

#åç«¯ä»£ç #
#åœ¨ backend æ–‡ä»¶å¤¹ä¸­ï¼Œåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Node.js é¡¹ç›®#
mkdir backend
cd backend
npm init -y
npm install express multer
#serve.js#
const express = require('express');
const multer = require('multer');
const path = require('path');
const app = express();

// è®¾ç½®å­˜å‚¨ä½ç½®å’Œæ–‡ä»¶å
const storage = multer.diskStorage({
  destination: function (req, file, cb) {
    cb(null, 'uploads/');
  },
  filename: function (req, file, cb) {
    cb(null, Date.now() + '-' + file.originalname);
  }
});

// åˆå§‹åŒ– multer ä¸Šä¼ é…ç½®
const upload = multer({ storage });

app.use(express.static('uploads'));  // å…è®¸å…¬å¼€è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶

// å›¾ç‰‡ä¸Šä¼ æ¥å£
app.post('/upload', upload.single('image'), (req, res) => {
  if (!req.file) {
    return res.status(400).send('No file uploaded.');
  }
  res.json({ fileUrl: `/uploads/${req.file.filename}` });
});

// å¯åŠ¨æœåŠ¡å™¨
app.listen(5000, () => {
  console.log('Server is running on http://localhost:5000');
});
#åˆ›å»ºä¸Šä¼ æ–‡ä»¶å¤¹#
mkdir uploads

#è¿æ¥å‰åç«¯#
#å®‰è£…cors#
npm install cors
#åœ¨serve.jsä¸­æ·»åŠ corsé…ç½®#
const cors = require('cors');
app.use(cors());
#å¯ç”¨åç«¯æœåŠ¡å™¨#
node backend/server.js
#å¯ç”¨å‰ç«¯reactåº”ç”¨!!å¿…é¡»åœ¨package.jsonæ ¹ç›®å½•ä¸‹è¿è¡Œ#
npm start
#è®¿é—®#
http://localhost:3000
